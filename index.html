<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>진격의 모기 (Attack on Mosquito)</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: #222;
    }
    #score {
      position: absolute;
      top: 10px;
      left: 10px;
      color: #fff;
      font-size: 24px;
      font-family: sans-serif;
      user-select: none;
    }
  </style>
</head>
<body>
  <canvas id="game" width="800" height="600"></canvas>
  <div id="score">Score: 0</div>

  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");

    // ------------------ Input ------------------
    const keys = {};
    document.addEventListener("keydown", (e) => (keys[e.key] = true));
    document.addEventListener("keyup", (e) => (keys[e.key] = false));

    // ------------------ Entities ------------------
    class Mosquito {
      constructor() {
        this.x = 400;
        this.y = 300;
        this.size = 16;
        this.speed = 3;
      }
      update() {
        if (keys["ArrowUp"] || keys["w"]) this.y -= this.speed;
        if (keys["ArrowDown"] || keys["s"]) this.y += this.speed;
        if (keys["ArrowLeft"] || keys["a"]) this.x -= this.speed;
        if (keys["ArrowRight"] || keys["d"]) this.x += this.speed;

        // Boundaries
        this.x = Math.max(0, Math.min(canvas.width - this.size, this.x));
        this.y = Math.max(0, Math.min(canvas.height - this.size, this.y));
      }
      draw() {
        // Body
        ctx.fillStyle = "yellow";
        ctx.beginPath();
        ctx.ellipse(
          this.x + this.size / 2,
          this.y + this.size / 2,
          this.size / 2,
          this.size / 4,
          0,
          0,
          Math.PI * 2
        );
        ctx.fill();

        // Wings
        ctx.fillStyle = "rgba(255,255,255,0.7)";
        ctx.beginPath();
        ctx.ellipse(
          this.x + this.size / 2 - 4,
          this.y + 4,
          this.size / 4,
          this.size / 8,
          0,
          0,
          Math.PI * 2
        );
        ctx.ellipse(
          this.x + this.size / 2 + 4,
          this.y + 4,
          this.size / 4,
          this.size / 8,
          0,
          0,
          Math.PI * 2
        );
        ctx.fill();
      }
      get rect() {
        return { x: this.x, y: this.y, w: this.size, h: this.size };
      }
    }

    class Human {
      constructor(x, y) {
        this.x = x;
        this.y = y;
        this.width = 40;
        this.height = 80;
        this.cooldown = 0;
      }
      update() {
        if (this.cooldown > 0) this.cooldown--;
        else if (Math.random() < 0.01) {
          // Attempt a swat
          swats.push(new Swat(this));
          this.cooldown = 120 + Math.random() * 60;
        }
      }
      draw() {
        ctx.fillStyle = "#8d5524"; // Simple placeholder color for human
        ctx.fillRect(this.x, this.y, this.width, this.height);
      }
      get rect() {
        return { x: this.x, y: this.y, w: this.width, h: this.height };
      }
    }

    class Swat {
      constructor(human) {
        this.x = human.x + human.width / 2;
        this.y = human.y;
        this.radius = 0;
        this.maxRadius = 60;
        this.alive = true;
      }
      update() {
        this.radius += 6;
        if (this.radius > this.maxRadius) this.alive = false;
      }
      draw() {
        ctx.strokeStyle = "red";
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
        ctx.stroke();
      }
      get rect() {
        return {
          x: this.x - this.radius,
          y: this.y - this.radius,
          w: this.radius * 2,
          h: this.radius * 2,
        };
      }
    }

    // ------------------ Utils ------------------
    function rectIntersect(a, b) {
      return (
        a.x < b.x + b.w &&
        a.x + a.w > b.x &&
        a.y < b.y + b.h &&
        a.y + a.h > b.y
      );
    }

    // ------------------ Game Setup ------------------
    const player = new Mosquito();
    const humans = [
      new Human(150, 200),
      new Human(350, 100),
      new Human(600, 250),
    ];
    let swats = [];
    let score = 0;
    let gameOver = false;

    // ------------------ Main Loop ------------------
    function loop() {
      if (gameOver) {
        drawGameOver();
        return;
      }

      ctx.clearRect(0, 0, canvas.width, canvas.height);

      player.update();
      player.draw();

      humans.forEach((h) => {
        h.update();
        h.draw();

        // Bite detection
        if (rectIntersect(player.rect, h.rect)) {
          score += 1;
          document.getElementById("score").textContent = "Score: " + score;
        }
      });

      // Swats
      swats = swats.filter((s) => s.alive);
      swats.forEach((s) => {
        s.update();
        s.draw();
        if (rectIntersect(player.rect, s.rect)) {
          gameOver = true;
        }
      });

      requestAnimationFrame(loop);
    }

    function drawGameOver() {
      ctx.fillStyle = "rgba(0, 0, 0, 0.5)";
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = "#fff";
      ctx.font = "48px sans-serif";
      ctx.textAlign = "center";
      ctx.fillText("Game Over", canvas.width / 2, canvas.height / 2);
      ctx.font = "24px sans-serif";
      ctx.fillText(
        "Refresh the page to play again",
        canvas.width / 2,
        canvas.height / 2 + 40
      );
    }

    // Start game
    loop();
  </script>
</body>
</html>
