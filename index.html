<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>진격의 모기</title>
  <style>
    body { margin:0; overflow:hidden; background:#222; color:#fff; font-family:sans-serif; }
    #ui { position:absolute; top:10px; left:10px; z-index:10; }
    #ui select, #ui button { font-size:16px; margin-right:10px; }
  </style>
</head>
<body>
  <div id="ui">
    <select id="charSelect">
      <option value="levi">레바이 모기</option>
      <option value="eren">에렌 모기</option>
    </select>
    <button id="startBtn">게임 시작</button>
    <span id="score">점수: 0</span>
  </div>
  <canvas id="game"></canvas>

  <script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    let W, H;
    function resize() {
      W = canvas.width = innerWidth;
      H = canvas.height = innerHeight;
    }
    window.addEventListener('resize', resize);
    resize();

    // 키 상태
    const keys = {};
    window.addEventListener('keydown', e => keys[e.key] = true);
    window.addEventListener('keyup',   e => keys[e.key] = false);

    // 게임 변수
    let player, attacks, score, running;

    class Player {
      constructor(x,y, color) {
        this.x = x; this.y = y;
        this.size = 20;
        this.color = color;
        this.speed = 4;
      }
      update() {
        if (keys['ArrowUp'] ) this.y -= this.speed;
        if (keys['ArrowDown']) this.y += this.speed;
        if (keys['ArrowLeft']) this.x -= this.speed;
        if (keys['ArrowRight'])this.x += this.speed;
        // 경계
        this.x = Math.max(this.size, Math.min(W - this.size, this.x));
        this.y = Math.max(this.size, Math.min(H - this.size, this.y));
      }
      draw() {
        ctx.fillStyle = this.color;
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.size, 0, Math.PI*2);
        ctx.fill();
        // 눈
        ctx.fillStyle = '#000';
        ctx.beginPath();
        ctx.arc(this.x - 5, this.y - 5, 4, 0, Math.PI*2);
        ctx.arc(this.x + 5, this.y - 5, 4, 0, Math.PI*2);
        ctx.fill();
      }
    }

    class Attack {
      constructor() {
        this.reset();
      }
      reset() {
        // 거인의 스와이프 시작 위치(랜덤 가장자리)
        const edge = Math.random() * 4 | 0;
        if (edge === 0) { this.x = 0; this.y = Math.random()*H; }
        if (edge === 1) { this.x = W; this.y = Math.random()*H; }
        if (edge === 2) { this.x = Math.random()*W; this.y = 0; }
        if (edge === 3) { this.x = Math.random()*W; this.y = H; }
        this.size = 40 + Math.random()*20;
        this.speed = 2 + Math.random()*2;
        // 타겟은 플레이어 현재 위치
        this.vx = 0; this.vy = 0;
      }
      update() {
        // 플레이어 방향으로 속도 설정 (한 번만)
        if (!this.vx && !this.vy) {
          const dx = player.x - this.x;
          const dy = player.y - this.y;
          const d = Math.hypot(dx, dy);
          this.vx = dx/d * this.speed;
          this.vy = dy/d * this.speed;
        }
        this.x += this.vx;
        this.y += this.vy;
        // 화면 벗어나면 재생성
        if (this.x < -50 || this.x > W+50 || this.y < -50 || this.y > H+50) {
          this.reset();
        }
      }
      draw() {
        ctx.fillStyle = 'rgba(200,0,0,0.7)';
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.size, 0, Math.PI*2);
        ctx.fill();
      }
      hits(p) {
        const dx = this.x - p.x;
        const dy = this.y - p.y;
        return Math.hypot(dx, dy) < this.size + p.size;
      }
    }

    function initGame() {
      attacks = [];
      for (let i=0; i<3; i++) attacks.push(new Attack());
      score = 0;
      running = true;
      const choice = document.getElementById('charSelect').value;
      const color = (choice === 'levi' ? '#0af' : '#fa0');
      player = new Player(W/2, H/2, color);
      document.getElementById('score').textContent = '점수: 0';
      requestAnimationFrame(loop);
    }

    function loop(timestamp) {
      if (!running) return;
      // 업데이트
      player.update();
      attacks.forEach(a => a.update());
      // 충돌 체크
      for (let a of attacks) {
        if (a.hits(player)) {
          running = false;
          alert('당신은 물렸다! 최종 점수: ' + score);
          return;
        }
      }
      // 그리기
      ctx.clearRect(0,0,W,H);
      player.draw();
      attacks.forEach(a => a.draw());
      // 점수
      score++;
      document.getElementById('score').textContent = '점수: ' + score;

      requestAnimationFrame(loop);
    }

    document.getElementById('startBtn').addEventListener('click', () => {
      if (!running) initGame();
      else if (!player) initGame();
    });
  </script>
</body>
</html>
